<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üê¥ Donkey Game</title>

  <link rel="icon" type="image/png" href="icon-512.png">
  <link rel="apple-touch-icon" href="icon-512.png">
  <link rel="manifest" href="manifest.json">

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker Registered"));
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d1117;
      color: white;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 { color: #00d9ff; margin-top: 20px; }
    .btn-primary, .btn-secondary, .btn-history {
      border: none; padding: 10px 20px; margin: 10px;
      border-radius: 8px; cursor: pointer; font-weight: bold;
    }
    .btn-primary { background: #00d9ff; color: #000; }
    .btn-secondary { background: #ff5050; color: white; }
    .btn-history { background: gold; color: black; }

    .game-table {
      background: radial-gradient(circle, #0b6623, #003300);
      border: 5px solid gold;
      border-radius: 40px;
      padding: 30px;
      margin: 30px auto;
      width: 85%;
    }

    .players-grid {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }

    .player-card {
      background: #1c1f26;
      border-radius: 20px;
      padding: 15px;
      width: 150px;
    }

    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid gold;
    }

    .round-inputs input {
      width: 80px;
      padding: 6px;
      border-radius: 10px;
      text-align: center;
      margin: 5px;
    }

    #error { color: #ff4d4d; font-weight: bold; }
    #loser { font-size: 22px; color: #ffcc00; }
    .hidden { display: none; }

    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
  </style>
</head>

<body>
<h1>üê¥ Donkey Game</h1>

<button onclick="openHistory()" class="btn-history">üìò Game History</button>

<div>
  <input id="p1" placeholder="Player 1">
  <input id="p2" placeholder="Player 2">
  <input id="p3" placeholder="Player 3">
  <input id="p4" placeholder="Player 4">
</div>

<button onclick="startGame()" class="btn-primary">Start Game</button>
<button onclick="resetGame()" class="btn-secondary">Reset</button>

<div id="gameTable" class="game-table hidden">

  <div class="players-grid">
    <div class="player-card"><img class="avatar" src="https://cdn-icons-png.flaticon.com/512/2922/2922506.png"><h3 id="name1"></h3>Score: <span id="score1">0</span></div>
    <div class="player-card"><img class="avatar" src="https://cdn-icons-png.flaticon.com/512/2922/2922510.png"><h3 id="name2"></h3>Score: <span id="score2">0</span></div>
    <div class="player-card"><img class="avatar" src="https://cdn-icons-png.flaticon.com/512/2922/2922656.png"><h3 id="name3"></h3>Score: <span id="score3">0</span></div>
    <div class="player-card"><img class="avatar" src="https://cdn-icons-png.flaticon.com/512/2922/2922688.png"><h3 id="name4"></h3>Score: <span id="score4">0</span></div>
  </div>

  <h3 id="roundTitle">Round 1</h3>

  <div class="round-inputs">
    <input type="number" id="r1" min="0" max="35">
    <input type="number" id="r2" min="0" max="35">
    <input type="number" id="r3" min="0" max="35">
    <input type="number" id="r4" min="0" max="35">
  </div>

  <div id="error"></div>

  <button onclick="submitRound()" class="btn-primary">Submit Round</button>
  <div id="loser"></div>
</div>

<canvas id="confetti"></canvas>

<script>
let scores = [0,0,0,0];
let round = 1;
const MAX_SCORE = 100;
const MAX_ROUND_POINTS = 35;

function startGame() {
  document.getElementById("gameTable").classList.remove("hidden");
  for (let i=1;i<=4;i++) {
    document.getElementById("name"+i).innerText =
      document.getElementById("p"+i).value || "Player "+i;
  }
}

function submitRound() {
  const errorDiv = document.getElementById("error");
  let roundScores = [];
  let indexOf35 = -1;

  for (let i=1;i<=4;i++) {
    let val = parseInt(document.getElementById("r"+i).value) || 0;
    val = Math.max(0, Math.min(val, MAX_ROUND_POINTS));
    if (val === 35 && indexOf35 === -1) indexOf35 = i-1;
    roundScores.push(val);
  }

  // ‚≠ê SPECIAL RULE ‚≠ê
  if (indexOf35 !== -1) {
    roundScores = [35,35,35,35];
    roundScores[indexOf35] = 0;
  } else {
    const total = roundScores.reduce((a,b)=>a+b,0);
    if (total > MAX_ROUND_POINTS) {
      errorDiv.innerText = "‚ùå Total points exceed 35";
      return;
    }
  }

  errorDiv.innerText = "";

  for (let i=0;i<4;i++) {
    scores[i] += roundScores[i];
    document.getElementById("score"+(i+1)).innerText = scores[i];
    document.getElementById("r"+(i+1)).value = "";
  }

  round++;
  document.getElementById("roundTitle").innerText = "Round " + round;
  checkLoser();
}

function checkLoser() {
  const idx = scores.findIndex(s => s >= MAX_SCORE);
  if (idx !== -1) {
    document.getElementById("loser").innerHTML =
      `üê¥ <b>${document.getElementById("name"+(idx+1)).innerText}</b> is the DONKEY!`;
  }
}

function resetGame() {
  scores=[0,0,0,0]; round=1;
  document.getElementById("roundTitle").innerText="Round 1";
  for (let i=1;i<=4;i++) {
    document.getElementById("score"+i).innerText="0";
    document.getElementById("r"+i).value="";
  }
  document.getElementById("loser").innerText="";
  document.getElementById("gameTable").classList.add("hidden");
}

function openHistory() {
  alert("History unchanged (your existing logic still works)");
}
</script>

</body>
</html>
